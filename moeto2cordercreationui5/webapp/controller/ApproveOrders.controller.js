sap.ui.define(["com/merckgroup/Moet_O2C_OrderCreation_UI5/controller/BaseController","sap/ui/model/json/JSONModel","com/merckgroup/Moet_O2C_OrderCreation_UI5/model/formatter","sap/ui/model/Filter","sap/ui/model/Sorter","sap/m/MessageBox"],function(e,t,o,i,r,s){"use strict";return e.extend("com.merckgroup.Moet_O2C_OrderCreation_UI5.controller.ApproveOrders",{custFormatter:o,onInit:function(){this.getRouter().getRoute("ApproveOrders").attachPatternMatched(this._onRouteMatched,this);this._loadODataUtils();this.getApproveOrderPropertySet();this.getItemCategoryData();this._getSystem();var e=new t({visible:true});this.getView().setModel(e,"jsonVisible")},_onRouteMatched:function(e){var t=this.getView().byId("smartTableApprove");var o=this.getView().getModel("viewProperties");var i=o.getData().LoginID;var r=this.getOwnerComponent().sUserRole;var s;if(r==="RSNO"){s="/SNOOrders";t.setTableBindingPath(s)}t.rebindTable();this.onDataReceived();this.getVisiblePlaceOrder();var a=this;setInterval(function(){a.userLogin()},3e5)},onDataReceived:function(){var e=this.getView().byId("smartTableApprove").getTable(),t=0,o=e.getColumns();jQuery.sap.delayedCall(100,this,function(){for(t=o.length;t>=0;t--){e.autoResizeColumn(t)}})},onBeforeRendering:function(){},onBeforeRebindTable:function(e){var t=e.getParameter("bindingParams");t.filters.push(new i("ZORD_STATUS","EQ","SNOA"));var o=this.getView().getModel("jsonVisible");if(this.getOwnerComponent().sUserRole==="CUST"){t.filters.push(new i("ZCREATED_BY","EQ",this.getOwnerComponent().sUserId));o.setProperty("/visible",false)}if(!t.sorter.length){t.sorter.push(new sap.ui.model.Sorter("ZINTR_ORDNUM",true));t.sorter.push(new sap.ui.model.Sorter("ZCHANGED_ON",true))}},onSimulateClose:function(){this._oSiDialog.close();if(this._oSiDialog){this._oSiDialog=this._oSiDialog.destroy()}},soLineClose:function(){this._oSSOLADialog.close();if(this._oSSOLADialog){this._oSSOLADialog=this._oSSOLADialog.destroy()}},soLineShow:function(e){var o=this._oCM1iDialog.getModel("OrderData1").getData();var i=this._oCM1iDialog.getModel("OrderDataF").getData();var r=this._oCM1iDialog.getModel("OrderData12");var a=this._oViewProperties=new t;a.setData(o);var n=e.getSource().getBindingContext("OrderData12").getObject();var l=this.getView().getModel("viewProperties1");var g,d=o.ZSYSTEM;var c=this.getView().getModel("jsonSystemData").getData();for(var h=0;h<c.length;h++){if(c[h].Yydesc==="LEAN"&&d==="L"){g=c[h].Yylow}else if(c[h].Yydesc==="TEMPO"&&d==="T"){g=c[h].Yylow}}var u="datetime%27"+this.formatDate1(n.ZREQ_DLVRYDAT)+"T00%3A00%3A00%27";var S="/ysoschedulelinesSet(distchnl='"+o.ZDISTR_CHNL+"',division='"+o.ZDIVISION+"',salesorg='"+o.ZSALES_AREA+"',customer='"+o.ZCUST_NUM+"',Material='"+n.ZMAT_NUM+"',Unit='"+n.ZALT_UOM+"',Sysid='"+g+"',ReqDate="+u+",ReqQty="+n.ZTRGT_QTY+")";sap.ui.core.BusyIndicator.show();this.getOwnerComponent().getModel("MOETSRV").read(S,{success:function(e,o){sap.ui.core.BusyIndicator.hide();var i=new t;i.setData(e);if(!this._oSSOLADialog){this._oSSOLADialog=sap.ui.xmlfragment("com.merckgroup.Moet_O2C_OrderCreation_UI5.fragments.orderSimulateAprSOLine",this);this.getView().addDependent(this._oSSOLADialog);this._oSSOLADialog.setModel(i,"ssoLineJson");this._oSSOLADialog.setModel(a,"ssoLineJson1")}if(e.Retmsg){s.show(e.Retmsg,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.CLOSE],styleClass:"sapUiSizeCompact myMessageBox"})}this._oSSOLADialog.open()}.bind(this),error:function(e){sap.ui.core.BusyIndicator.hide();s.show(e.message,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.CLOSE],styleClass:"sapUiSizeCompact myMessageBox"})}.bind(this)})},onAddCM1Press:function(e){var t;if(e.getParameter("row")){t=e.getParameter("row").getBindingContext().getObject()}else if(e.getParameter("rowContext")){t=e.getParameter("rowContext").getObject()}else if(e.getSource().getBindingContext()){t=e.getSource().getBindingContext().getObject()}this.getApproveOrderData(t)},pressAddAttachment:function(e){var t=this.getView().getModel("viewProperties1");this.oAttachData=e.getSource();var o,i,r,s=t.getProperty("/ZDOC_ID");if(s){o=s.split("_MOET_")[0];i=s.split("_MOET_")[1]}else{oData[sComSpec]=""}if(o&&i){sap.m.URLHelper.redirect("/CMIS/cmis/download?docId="+o,true)}else{}},onAssignedFiltersChanged:function(e){var t=e.getSource();for(var o in t._oFilterProvider._mTokenHandler){var i=t._oFilterProvider._mTokenHandler[o];if(i&&i.parser){i.parser.setDefaultOperation("Contains")}}},onInitialized:function(e){var t=e.getSource();for(var o in t._oFilterProvider._mTokenHandler){var i=t._oFilterProvider._mTokenHandler[o];if(i&&i.parser){i.parser.setDefaultOperation("Contains")}}}})});